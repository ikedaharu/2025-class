<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ€ã‚¤ã‚¢ãƒ«å›è»¢å¼ãŠã¿ãã˜ App</title>
  <style>
    body {
      text-align: center;
      padding: 50px;
      background-color: #f0f8ff;
    }
    
    h1 {
      margin: 0;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px #aaa;
      display: inline-block;
    }

    button {
      padding: 10px 20px;
      font-size: 18px;
      background: #ffcc00;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
    }

    /*ã“ã“ã‹ã‚‰å¤§æ”¹é€ ä¸­*/
    /* ãƒ€ã‚¤ã‚¢ãƒ«è¡¨ç¤ºã‚¨ãƒªã‚¢ */
    .dial-container {
      height: 80px;
      overflow: hidden;
      border: 3px solid #333;
      border-radius: 10px;
      margin: 20px 0;
      position: relative;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ãƒ€ã‚¤ã‚¢ãƒ«ã®å›è»¢éƒ¨åˆ† */
    .dial {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .dial.visible {
      opacity: 1;
    }

    .dial.spinning {
      transition: transform 5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    /* å„é‹å‹¢é …ç›® */
    .fortune-item {
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
      min-width: 200px;
      flex-shrink: 0;
    }

    /* é‹å‹¢ã”ã¨ã®è‰²åˆ†ã‘ */
    .fortune-item[data-fortune="å¤§å‰"] { color: #e74c3c; }
    .fortune-item[data-fortune="å‰"] { color: #f39c12; }
    .fortune-item[data-fortune="ä¸­å‰"] { color: #f1c40f; }
    .fortune-item[data-fortune="å°å‰"] { color: #27ae60; }
    .fortune-item[data-fortune="æœ«å‰"] { color: #3498db; }
    .fortune-item[data-fortune="å‡¶"] { color: #9b59b6; }
    .fortune-item[data-fortune="å¤§å‡¶"] { color: #2c3e50; }

    /* é¸æŠã•ã‚ŒãŸé …ç›®ã‚’ç¤ºã™ãƒ•ãƒ¬ãƒ¼ãƒ  */
    .selection-frame {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 5px solid #ff6b6b;
      border-radius: 7px;
      pointer-events: none;
      box-shadow: inset 0 0 20px rgba(255, 107, 107, 0.3);
    }

    /* çµæœè¡¨ç¤º */
    .result-text {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
      min-height: 30px;
    }

    /* ãƒ‡ãƒãƒƒã‚°æƒ…å ± */
    .debug-info {
      font-size: 12px;
      color: #666;
      margin-top: 10px;
    }

    /* ãƒœã‚¿ãƒ³ã®ç„¡åŠ¹åŒ–æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* çµæœç¢ºå®šæ™‚ã®å¼·èª¿è¡¨ç¤º */
    .fortune-item.selected {
      background: linear-gradient(45deg, #fff3cd, #ffeaa7);
      border-radius: 5px;
      box-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* çµæœè¡¨ç¤ºç”¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .result-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 7px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.5s ease;
      z-index: 10;
    }

    .result-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .result-overlay .fortune-display {
      font-size: 36px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      animation: fadeInScale 0.5s ease;
    }

    @keyframes fadeInScale {
      0% { 
        transform: scale(0.5);
        opacity: 0;
      }
      100% { 
        transform: scale(1);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ° ãƒ€ã‚¤ã‚¢ãƒ«å¼ãŠã¿ãã˜ã‚¢ãƒ—ãƒª</h1>
    
    <div class="dial-container">
      <div class="selection-frame"></div>
      <div class="dial" id="dial">
        <!-- é‹å‹¢é …ç›®ã¯ JavaScript ã§ç”Ÿæˆ -->
      </div>
      <div class="result-overlay" id="resultOverlay">
        <div class="fortune-display" id="fortuneDisplay"></div>
      </div>
    </div>
    
    <div class="result-text" id="result">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãŠã¿ãã˜ã‚’å¼•ã„ã¦ãã ã•ã„</div>
    <div class="debug-info" id="debug"></div>
    <button id="draw">ğŸ¯ ãŠã¿ãã˜ã‚’å¼•ã</button>
  </div>

  <script>
    const omikujiResults = ['å¤§å‰', 'å‰', 'ä¸­å‰', 'å°å‰', 'æœ«å‰', 'å‡¶', 'å¤§å‡¶'];
    const dial = document.getElementById('dial');
    const resultElement = document.getElementById('result');
    const debugElement = document.getElementById('debug');
    const drawButton = document.getElementById('draw');
    let isFirstDraw = true;

    // ãƒ€ã‚¤ã‚¢ãƒ«ã®åˆæœŸåŒ–
    function initializeDial() {
      dial.innerHTML = '';
      
      // å›è»¢æ¼”å‡ºã®ãŸã‚ã«é‹å‹¢ã‚’ååˆ†ã«ç¹°ã‚Šè¿”ã—è¡¨ç¤º
      const repeats = 8; // ç¹°ã‚Šè¿”ã—å›æ•°ã‚’å¢—ã‚„ã—ã¦å®‰å…¨æ€§ã‚’å‘ä¸Š
      for (let r = 0; r < repeats; r++) {
        omikujiResults.forEach((fortune, index) => {
          const item = document.createElement('div');
          item.className = 'fortune-item';
          item.setAttribute('data-fortune', fortune);
          item.textContent = fortune;
          item.setAttribute('data-index', r * omikujiResults.length + index);
          item.setAttribute('data-set', r); // ã©ã®ã‚»ãƒƒãƒˆã‹ã‚’è¨˜éŒ²
          dial.appendChild(item);
        });
      }
      
      // åˆæœŸä½ç½®ã‚’è¨­å®šï¼ˆæœ€åˆã®é …ç›®ãŒä¸­å¤®ã«æ¥ã‚‹ã‚ˆã†ã«ï¼‰
      dial.style.transform = 'translateY(0px)';
      /*updateDebugInfo('åˆæœŸåŒ–å®Œäº†', 0);*/
    }

    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’æ›´æ–°
    function updateDebugInfo(action, position) {
      debugElement.textContent = `${action}: ä½ç½® ${position}px`;
    }

    // ãŠã¿ãã˜ã‚’å¼•ãå‡¦ç†
    drawButton.addEventListener('click', function() {
      // å‰å›ã®é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
      document.querySelectorAll('.fortune-item.selected').forEach(item => {
        item.classList.remove('selected');
      });

      // å‰å›ã®çµæœã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éš ã™
      hideResultInDial();

      if (isFirstDraw) {
        // åˆå›ï¼šãƒ€ã‚¤ã‚¢ãƒ«ã‚’è¡¨ç¤ºã—ã¦ãƒœã‚¿ãƒ³ã‚’éš ã™
        dial.classList.add('visible');
        drawButton.style.display = 'none';
        isFirstDraw = false;
        
        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        setTimeout(() => {
          startDrawing();
        }, 500);
      } else {
        // å¼•ãç›´ã—ï¼šã¾ãšåˆæœŸä½ç½®ã«ãƒªã‚»ãƒƒãƒˆ
        resetDialPosition();
        setTimeout(() => {
          startDrawing();
        }, 100);
      }
    });

    // ãƒ€ã‚¤ã‚¢ãƒ«ä½ç½®ã‚’ãƒªã‚»ãƒƒãƒˆ
    function resetDialPosition() {
      dial.classList.remove('spinning');
      dial.style.transform = 'translateY(0px)';
      updateDebugInfo('ä½ç½®ãƒªã‚»ãƒƒãƒˆ', 0);
    }

    function startDrawing() {
      // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      drawButton.disabled = true;
      resultElement.textContent = 'é‹å‹¢ã‚’å ã„ä¸­...';
      
      // ãƒ©ãƒ³ãƒ€ãƒ ãªçµæœã‚’é¸æŠ
      const selectedFortune = omikujiResults[Math.floor(Math.random() * omikujiResults.length)];
      /*updateDebugInfo('é¸æŠã•ã‚ŒãŸé‹å‹¢', selectedFortune);*/
      
      // å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
      startSpinAnimation(selectedFortune);
    }

    function startSpinAnimation(targetFortune) {
      // ã‚¢ã‚¤ãƒ†ãƒ ã®é«˜ã•
      const itemHeight = 80;
      
      // æœ€çµ‚ã‚»ãƒƒãƒˆï¼ˆè¡¨ç¤ºç”¨ï¼‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨ˆç®—
      const finalSetIndex = 6; // 7ç•ªç›®ã®ã‚»ãƒƒãƒˆï¼ˆ0ã‹ã‚‰æ•°ãˆã¦6ï¼‰ã‚’ä½¿ç”¨
      const fortuneIndex = omikujiResults.indexOf(targetFortune);
      const targetItemIndex = finalSetIndex * omikujiResults.length + fortuneIndex;
      
      // æœ€çµ‚ä½ç½®ã‚’è¨ˆç®—ï¼ˆç›®æ¨™ã®é‹å‹¢ãŒãƒ€ã‚¤ã‚¢ãƒ«ä¸­å¤®ã«æ¥ã‚‹ã‚ˆã†ã«ï¼‰
      // ãƒ€ã‚¤ã‚¢ãƒ«ä¸­å¤®ã¯ container ã®é«˜ã•(80px)ã®åŠåˆ†ãªã®ã§ã€40pxåˆ†ä¸Šã«ãšã‚‰ã™
      const finalPosition = -(targetItemIndex * itemHeight) + 40;
      
      /*updateDebugInfo(`å›è»¢é–‹å§‹ - ç›®æ¨™: ${targetFortune} (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: ${targetItemIndex})`, finalPosition);*/
      
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
      setTimeout(() => {
        dial.classList.add('spinning');
        dial.style.transform = `translateY(${finalPosition}px)`;
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã®å‡¦ç†
        setTimeout(() => {
          dial.classList.remove('spinning');
          
          // é¸æŠã•ã‚ŒãŸé …ç›®ã«å¼·èª¿ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
          const selectedItems = document.querySelectorAll(`[data-index="${targetItemIndex}"]`);
          selectedItems.forEach(item => {
            item.classList.add('selected');
          });
          
          // ãƒ€ã‚¤ã‚¢ãƒ«éƒ¨åˆ†ã«çµæœã‚’è¡¨ç¤º
          showResultInDial(targetFortune);
          
          drawButton.disabled = false;
          drawButton.style.display = 'inline-block';
          drawButton.textContent = 'ğŸ”„ å¼•ãç›´ã™';
          resultElement.textContent = `ã‚ãªãŸã®é‹å‹¢ã¯ã€Œ${targetFortune}ã€ã§ã™ï¼`;
          
          // çµæœã«å¿œã˜ãŸè‰²ã‚’é©ç”¨
          resultElement.style.color = getFortuneColor(targetFortune);
          /*updateDebugInfo(`ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº† - ${targetFortune}è¡¨ç¤ºä¸­`, finalPosition);*/
        }, 3000);
      }, 100);
    }

    // é‹å‹¢ã«å¿œã˜ãŸè‰²ã‚’å–å¾—
    function getFortuneColor(fortune) {
      const colors = {
        'å¤§å‰': '#e74c3c',
        'å‰': '#f39c12',
        'ä¸­å‰': '#f1c40f',
        'å°å‰': '#27ae60',
        'æœ«å‰': '#3498db',
        'å‡¶': '#9b59b6',
        'å¤§å‡¶': '#2c3e50'
      };
      return colors[fortune] || '#2c3e50';
    }

    // ãƒ€ã‚¤ã‚¢ãƒ«éƒ¨åˆ†ã«çµæœã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function showResultInDial(fortune) {
      const resultOverlay = document.getElementById('resultOverlay');
      const fortuneDisplay = document.getElementById('fortuneDisplay');
      
      fortuneDisplay.textContent = fortune;
      fortuneDisplay.style.color = getFortuneColor(fortune);
      resultOverlay.classList.add('show');
    }

    // çµæœã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éš ã™é–¢æ•°
    function hideResultInDial() {
      const resultOverlay = document.getElementById('resultOverlay');
      resultOverlay.classList.remove('show');
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ€ã‚¤ã‚¢ãƒ«ã‚’åˆæœŸåŒ–ï¼ˆéè¡¨ç¤ºçŠ¶æ…‹ã§ï¼‰
    initializeDial();
  </script>
</body>
</html>